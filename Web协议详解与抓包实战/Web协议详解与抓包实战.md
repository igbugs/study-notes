## Web协议详解与抓包实战

### 03丨浏览器发起HTTP请求的典型场景

![image-20230610112557826](.\assets\image-20230610112557826.png)

```
1. 输入URL地址，浏览器怎么联想到你想输入的地址？因为浏览器内部有一个数据库，存放历史的浏览地址输入
2. 渲染引擎负载资源的网络请求，解析js和css、html，进行UI的渲染绘制

ctrl+shift+I  打开F12开发者工具

3. 渲染引擎发起第一个请求后，解析获取资源的超链接，从中继续发起新的请求需要的css、html、js、图片等，渲染 引擎解析后发现新的dom数据的变化就会发送新的请求，最终获取到所有资源后，进行UI绘制
```

![image-20230610113734778](.\assets\image-20230610113734778.png)

![image-20230610113837614](.\assets\image-20230610113837614-16863683181031.png)

```
HTTP协议的定义
stateless: 无状态的，后一个请求不能依赖请一个请求的字段，头部等
extensible semantics: 可扩展语义的，现在http 1.0 依然可以使用，进行扩展出 http 1.1/http 2.0/http 3.0 等 
self-desctiptive: 从一个请求，就可以知道这个请求是视频图片或文本，而不依赖与其他的请求
hypertext information: 不止能传输文本，还可以传输视频图片音频等内容
```

### 04丨基于ABNF语义定义的HTTP消息格式

![image-20230610114505688](.\assets\image-20230610114505688.png)

```
黄色的为start-line
蓝色的为头部字段
紫色的为body体

这种口语化的表述不够严谨
```

![image-20230610114834977](.\assets\image-20230610114834977.png)

![image-20230610115014766](.\assets\image-20230610115014766.png)

![image-20230610115128405](.\assets\image-20230610115128405.png)

![image-20230610115457604](.\assets\image-20230610115457604.png)

![image-20230610115639802](.\assets\image-20230610115639802.png)

![image-20230610115714593](.\assets\image-20230610115714593.png)

![image-20230610120052437](.\assets\image-20230610120052437-16863696529023.png)

```
0d 0a   ==>  \r\n
Host: www.taohui.pub  这个header 对应的数据 从48 6f 开始 （蓝色的）
```

### 05丨网络为什么要分层：OSI模型与TCP-IP模型

![image-20230610130312380](.\assets\image-20230610130312380.png)

![image-20230610130656456](.\assets\image-20230610130656456.png)

![image-20230610130835714](.\assets\image-20230610130835714.png)

![image-20230610131209158](.\assets\image-20230610131209158.png)

![image-20230610131305411](.\assets\image-20230610131305411.png)

### 06丨HTTP解决了什么问题？

![image-20230610131433033](.\assets\image-20230610131433033.png)

![image-20230610131641473](.\assets\image-20230610131641473.png)

### 07丨评估Web架构的七大关键属性

![image-20230610132002345](.\assets\image-20230610132002345.png)

![image-20230610132158229](.\assets\image-20230610132158229.png)

![image-20230610132407206](.\assets\image-20230610132407206.png)

![image-20230610132526671](.\assets\image-20230610132526671.png)

```
user Agent: 浏览器
$ 在左边客户端缓存， $ 在右边服务器缓存
```

### 08丨从五种架构风格推导出HTTP的REST架构

![image-20230610132816600](.\assets\image-20230610132816600.png)

![image-20230610132919348](.\assets\image-20230610132919348-168637496421510.png)

![image-20230610133049779](.\assets\image-20230610133049779.png)

![image-20230610133120549](.\assets\image-20230610133120549.png)

![image-20230610133220193](.\assets\image-20230610133220193.png)

![image-20230610133242722](.\assets\image-20230610133242722.png)

![image-20230610133629159](.\assets\image-20230610133629159.png)

![image-20230610133721111](.\assets\image-20230610133721111.png)

![image-20230610133904544](.\assets\image-20230610133904544.png)

![image-20230610133944369](.\assets\image-20230610133944369.png)

```
COD: 例如服务器发送js代码，到浏览器执行
 
```

![image-20230610135406263](.\assets\image-20230610135406263.png)

```
齿轮代表服务器发送的代码，在客户端执行
```

![image-20230610141222269](.\assets\image-20230610141222269.png)

![image-20230610141541921](.\assets\image-20230610141541921.png)

![image-20230610141706425](.\assets\image-20230610141706425.png)

 ![image-20230610141730518](.\assets\image-20230610141730518.png)

```
REST架构是如何从其他5中架构推演而来
```

### 09丨如何用Chrome的Network面板分析HTTP报文

![image-20230610142013407](.\assets\image-20230610142013407.png)

 ![image-20230610142052354](.\assets\image-20230610142052354.png)

![image-20230610142142982](.\assets\image-20230610142142982.png)

![image-20230610142227887](.\assets\image-20230610142227887.png)

![image-20230610142610036](.\assets\image-20230610142610036.png)

![image-20230610150559219](.\assets\image-20230610150559219.png)

![image-20230610150540797](.\assets\image-20230610150540797.png)

![image-20230610150705783](.\assets\image-20230610150705783.png)

![image-20230610150732495](.\assets\image-20230610150732495.png)

![image-20230610150828348](.\assets\image-20230610150828348.png)

![image-20230610150854035](.\assets\image-20230610150854035.png)

![image-20230610152502349](.\assets\image-20230610152502349.png)

![image-20230610152602475](.\assets\image-20230610152602475.png)

![image-20230610152618724](.\assets\image-20230610152618724.png)

![image-20230610152646799](.\assets\image-20230610152646799.png)

![image-20230610152727554](.\assets\image-20230610152727554.png)

![image-20230610152910900](.\assets\image-20230610152910900.png)

![image-20230610152941237](.\assets\image-20230610152941237.png)

![image-20230610153019890](.\assets\image-20230610153019890.png)

![image-20230610153316173](.\assets\image-20230610153316173.png)

![image-20230610153400604](.\assets\image-20230610153400604.png)

 ![image-20230610153700577](.\assets\image-20230610153700577.png)

### 10丨URI的基本格式以及与URL的区别

![image-20230610153804777](.\assets\image-20230610153804777.png)

![image-20230610153831936](.\assets\image-20230610153831936.png)

![image-20230610153921322](.\assets\image-20230610153921322.png)

```
引入新标识符：之前可能只能下载图片文本，后续有可以下载视频音频
允许统一资源在不通上下文出现：爬虫可以访问，人在浏览器也可以访问
```

![image-20230610154254280](.\assets\image-20230610154254280.png)

```
#fragid1  fragment是分段

urn Uniform Resource Nmame
```

![image-20230610154714492](.\assets\image-20230610154714492.png)

![image-20230610154756890](.\assets\image-20230610154756890.png)

![image-20230610154848403](.\assets\image-20230610154848403.png)

 ![image-20230610154948648](.\assets\image-20230610154948648.png)

![image-20230610155104314](.\assets\image-20230610155104314.png)

### 11丨为什么要对 URI 进行编码？

![image-20230610155249834](.\assets\image-20230610155249834.png)

![image-20230610155413570](.\assets\image-20230610155413570.png)

![image-20230610155445408](.\assets\image-20230610155445408.png)

### 12丨详解 HTTP 的请求行

![image-20230610155739046](.\assets\image-20230610155739046.png)

![image-20230610160742964](.\assets\image-20230610160742964.png)

![image-20230610160851617](.\assets\image-20230610160851617.png)

![image-20230610160940949](.\assets\image-20230610160940949.png)

![image-20230610161318455](.\assets\image-20230610161318455.png)

![image-20230610161347558](.\assets\image-20230610161347558.png)

```
webdav 支持多人协作的文档管理
```

![image-20230610161623158](.\assets\image-20230610161623158.png)

![image-20230610161921826](.\assets\image-20230610161921826.png)

![image-20230610162005327](.\assets\image-20230610162005327.png)

![image-20230610162041857](.\assets\image-20230610162041857.png)

### 13丨HTTP 的正确响应码

![image-20230610163302787](.\assets\image-20230610163302787.png)

```
3DIGIT 三个字节的响应码
```

![image-20230610163558451](.\assets\image-20230610163558451.png)

![image-20230610163751326](.\assets\image-20230610163751326.png)

```
迅雷下载中有 Expext: 100-continue 的请求头
```

![image-20230610163934581](.\assets\image-20230610163934581.png)

![image-20230610164040986](.\assets\image-20230610164040986.png)

![image-20230610164146233](.\assets\image-20230610164146233.png)

![image-20230610164323262](.\assets\image-20230610164323262.png)

![image-20230610164434722](.\assets\image-20230610164434722.png)

![image-20230610164532603](.\assets\image-20230610164532603.png)

### 14丨HTTP 的错误响应码

![image-20230610164903489](.\assets\image-20230610164903489.png)

![image-20230610165058072](.\assets\image-20230610165058072.png)

![image-20230610165137181](.\assets\image-20230610165137181.png)

![image-20230610165313614](.\assets\image-20230610165313614.png)

![image-20230610165439961](.\assets\image-20230610165439961.png)

![image-20230610165634985](.\assets\image-20230610165634985.png)

![image-20230610165730658](.\assets\image-20230610165730658.png)

```
当客户端接受到了一个不认识的响应码，按此类响应码的第一个响应码处理：
如222 按200 处理；555按500处理
```



### 15丨如何管理跨代理服务器的长短连接？

![image-20230610170026684](.\assets\image-20230610170026684.png)

![image-20230610170137962](.\assets\image-20230610170137962.png)

![image-20230610170211722](.\assets\image-20230610170211722.png)

```
代理服务器转发的时候，不转发Connection中列出的头部（如cookie），代理服务器转发到原服务器的时候，就去除相应的头部
```

![image-20230610170500857](.\assets\image-20230610170500857.png)

![image-20230610172512110](.\assets\image-20230610172512110.png)

![image-20230610173900831](.\assets\image-20230610173900831.png)

### 16丨HTTP 消息在服务器端的路由

![image-20230610174010570](.\assets\image-20230610174010570.png)

![image-20230610174520596](.\assets\image-20230610174520596.png)

![image-20230610174545272](.\assets\image-20230610174545272.png)

```
解析Reaquest Header获取主机或域名，匹配相应的server name
```

### 17丨代理服务器转发消息时的相关头部

![image-20230610174834100](.\assets\image-20230610174834100.png)

![image-20230610174926994](.\assets\image-20230610174926994.png)

```
X-Real-IP 是nginx 中定义的头，传递用户的IP
X-Forworaded-For 记录了没经过一个代理的IP地址列表 逗号隔开
```

![image-20230610175301685](.\assets\image-20230610175301685.png)

![image-20230610175400125](.\assets\image-20230610175400125.png)

### 18丨请求与响应的上下文

![image-20230610175544415](.\assets\image-20230610175544415.png)

![image-20230610175737136](.\assets\image-20230610175737136.png)

![image-20230610175830783](.\assets\image-20230610175830783.png)

```
从谷歌搜索 陶辉笔记 ，Referer是从谷歌转来的
```

![image-20230610180133654](.\assets\image-20230610180133654.png)

```
从本站点的第一个请求引入的 Referer是本站点
```

```
缓存优化：对某些站点来的才会做会存优化
```

![image-20230610180340210](.\assets\image-20230610180340210.png)

![image-20230610180413236](.\assets\image-20230610180413236.png)

![image-20230610180444428](.\assets\image-20230610180444428.png)

### 19丨内容协商与资源表述

![image-20230610180720050](.\assets\image-20230610180720050.png)

![image-20230610180822086](.\assets\image-20230610180822086.png)

```
服务器支持的表述都发送给客户端，有客户端选择相应的表述
```

![image-20230610180947194](.\assets\image-20230610180947194.png)

![image-20230610181056607](.\assets\image-20230610181056607.png)

```
相应式内容协助很少用，因为规范中没有明确说明client依据怎样的规则来进行选择，各大浏览器无法按统一策略进行选择合适表述
```

![image-20230610181317504](.\assets\image-20230610181317504.png)

```
q 协商发送资源的质量

```

![image-20230610181430824](.\assets\image-20230610181430824.png)

```
逗号隔开，分号后面是对应语言的优先级
```

![image-20230610181600815](.\assets\image-20230610181600815.png)

  ![image-20230610181705762](.\assets\image-20230610181705762.png)

### 20丨HTTP包体的传输方式（1）：定长包体

